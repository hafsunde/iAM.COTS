% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/iam.cots.fun.R
\name{iam.cots.fun}
\alias{iam.cots.fun}
\title{Fit an Extended Children-of-Twins model with indirect assortative mating
Written by Hans Fredrik Sunde (hfsu@fhi.no)}
\usage{
iam.cots.fun(
  dta,
  selVars = c("FAM1_Sib", "FAM2_Sib", "FAM1_Spouse", "FAM2_Spouse", "FAM1_CH1",
    "FAM1_CH2", "FAM2_CH1", "FAM2_CH2"),
  name = "iAM_COTS",
  ...,
  a1.free = TRUE,
  c1.free = TRUE,
  t1.free = FALSE,
  a1.val = 0.2,
  c1.val = 0.2,
  t1.val = 0,
  e1.val = 0.8,
  p.free = TRUE,
  a1p.free = TRUE,
  c1p.free = TRUE,
  a2.free = TRUE,
  c2.free = TRUE,
  c2.cousin = FALSE,
  mu.free = TRUE,
  mu.val = 0.3,
  U.f = 1,
  indirect.assortment = FALSE,
  VarS_constraint = FALSE,
  a1s.free = TRUE,
  c1s.free = TRUE,
  t1s.free = FALSE,
  e1s.free = FALSE,
  a1s.val = NULL,
  c1s.val = NULL,
  t1s.val = NULL,
  e1s.val = NULL,
  cor.preferences = F,
  preferences.mz.dz = T,
  parental_rGE = FALSE,
  rGE_lbound = -1,
  rGE_twostep = TRUE,
  combine.FS_DZ = FALSE,
  use.fullsibs = TRUE,
  use.halfsibs = FALSE,
  halfsib.cor = 0,
  use.unknownzyg = FALSE,
  MZprop = 0.5,
  parent_ordinal = FALSE,
  child_ordinal = FALSE,
  factor.levels = c(0, 1),
  fitFunction = "ML",
  compute.intervals = FALSE,
  TryHard = FALSE,
  RunModel = TRUE
)
}
\arguments{
\item{dta}{Data.frame containing family-level data. Must include a column named
\code{fam.type} indicating group membership (strings containing "MZ", "DZ", and
optionally "FS", "HS", "UZ") and the observed variables specified by
\code{selVars}.}

\item{selVars}{Character vector of length 8 specifying observed variable names
in the following order: parental pair, spouses, and offspring:
\code{c(FAM1_Sib, FAM2_Sib, FAM1_Spouse, FAM2_Spouse, FAM1_CH1, FAM1_CH2, FAM2_CH1, FAM2_CH2)}.}

\item{name}{Character scalar, name of the top-level OpenMx model.}

\item{...}{All arguments after ... must be named.}

\item{a1.free, c1.free, t1.free}{Logical; free/fix parental A/C/T paths for the focal phenotype.}

\item{a1.val, c1.val, t1.val, e1.val}{Numeric starting values for parental A/C/T/E paths.}

\item{p.free, a1p.free, c1p.free}{Logical; free/fix intergenerational paths:
phenotypic transmission (\code{p}), genetic transmission/confounding (\code{a1p}),
and passive environmental transmission/confounding (\code{c1p}).}

\item{a2.free, c2.free}{Logical; free/fix offspring-specific A/C paths.}

\item{c2.cousin}{Logical; estimate residual cousin-shared environment correlation (\code{rc}).}

\item{mu.free}{Logical; free/fix assortative mating strength parameter (\code{mu_param}).}

\item{mu.val}{Numeric starting value for assortative mating strength.}

\item{U.f}{Numeric in \{0,1\}; 0 indicates first generation of assortment (disequilibrium),
1 indicates intergenerational equilibrium.}

\item{indirect.assortment}{Logical; if \code{FALSE}, sorting factor is equated to the focal
phenotype; if \code{TRUE}, includes a separate sorting factor with its own ACTE paths.}

\item{VarS_constraint}{Logical; constrain variance of the sorting factor to equal the focal
phenotype variance (\code{var1}).}

\item{a1s.free, c1s.free, t1s.free, e1s.free}{Logical; free/fix ACTE paths to the sorting factor
(used when \code{indirect.assortment = TRUE}; otherwise constrained to equal corresponding
focal-phenotype paths).}

\item{a1s.val, c1s.val, t1s.val, e1s.val}{Optional numeric starting values for sorting-factor paths.
If \code{NULL}, defaults to corresponding focal-phenotype values/labels as implemented in the function.}

\item{cor.preferences}{Logical; include sibling-correlated mate preferences (affecting co-in-law covariance).}

\item{preferences.mz.dz}{Logical; allow preference-correlation to differ by relatedness (MZ/DZ/UZ/HS).}

\item{parental_rGE}{Logical or numeric; controls the gene-environment correlation parameter \code{w}.
If \code{FALSE}, fixes \code{w=0}. If \code{TRUE}, estimates \code{w} with a constraint linking it to
the implied offspring rGE. If numeric, fixes \code{w} to that value (must be between -1 and 1).}

\item{rGE_lbound}{Numeric lower bound for \code{w}.}

\item{rGE_twostep}{Logical; if \code{TRUE} and \code{parental_rGE=TRUE}, runs a two-step procedure:
first with \code{w=0}, then re-runs estimating \code{w} under the rGE constraint.}

\item{combine.FS_DZ}{Logical; combine full-sibling and DZ groups into one group (disables T components for parents).}

\item{use.fullsibs}{Logical; include FS group if present.}

\item{use.halfsibs}{Logical; include HS group if present.}

\item{halfsib.cor}{Numeric; C-correlation for half siblings (used when \code{use.halfsibs=TRUE}).}

\item{use.unknownzyg}{Logical; include UZ group if present.}

\item{MZprop}{Numeric; assumed proportion of MZ pairs in the UZ group (used to compute genetic correlation).}

\item{parent_ordinal, child_ordinal}{Logical; treat parental and/or offspring phenotypes as ordinal.}

\item{factor.levels}{Vector of factor levels used for ordinal variables (default \code{c(0,1)}).}

\item{fitFunction}{Character; "ML" or "WLS".}

\item{compute.intervals}{Logical; compute confidence intervals for selected derived parameters.}

\item{TryHard}{Logical; use mxTryHard / mxTryHardOrdinal.}

\item{RunModel}{Logical; if \code{FALSE}, returns the unfit OpenMx model object.}
}
\value{
If \code{RunModel=TRUE}, returns an OpenMx fit object (\code{MxModel}) from \code{mxRun}.
Otherwise returns the constructed (unfit) \code{MxModel}. The model includes derived parameter
algebras for variance decompositions, implied correlations, and parent-offspring decomposition.
}
\description{
Fits an Extended Children-of-Twins (COTS) structural equation model in OpenMx,
including spouses and two offspring per nuclear family. The model supports
monozygotic (MZ) and dizygotic (DZ) twin families, with optional inclusion of
full-sibling (FS), half-sibling (HS), and unknown-zygosity (UZ) groups.
}
\details{
The model decomposes variance in the parental (focal) phenotype into additive
genetic (A), sibling-shared environment (C), twin-shared environment (T; optional),
and unique environment (E). Intergenerational resemblance is modeled via
phenotypic transmission (p), genetic transmission/confounding (a1p), and passive
environmental transmission/confounding (c1p). Offspring-specific variance is
decomposed into A (a2), C (c2), and E (e2), with an optional residual shared-
environmental correlation between cousins (rc).

Assortative mating can be modeled as direct assortment on the focal phenotype
or as indirect assortment via a sorting factor. In the indirect assortment case,
the paths from A/C/T/E to the sorting factor can be freely estimated (subject to
identification constraints) and the model can optionally adjust for correlated
mate preferences (Z parameters), which otherwise can inflate co-in-law
correlations.

Both continuous and dichotomous (ordinal) outcomes are supported via
mxExpectationNormal, using thresholds when \code{parent_ordinal} and/or
\code{child_ordinal} are \code{TRUE}. Model fitting can be ML or WLS.

Expected data structure is one row per extended family with columns given by \code{selVars} and
a grouping variable \code{fam.type}. The function performs basic checks for required groups and
will error if requested groups are absent.
}
\section{Dependencies}{

Requires the \pkg{OpenMx} package.
}

\seealso{
\code{\link[OpenMx]{mxModel}}, \code{\link[OpenMx]{mxRun}}, \code{\link[OpenMx]{mxTryHard}}
}
